# Yesterday Server Override Configuration
# Copy this to docker-compose.override.yml on the yesterday server
#
# Set in .env: COMPOSE_PROFILES=frontend,database,backend,dev,monitoring
#
# This configuration:
# - Disables production-build containers (not needed on Yesterday, dev containers are faster)
# - Disables MCP containers (not needed on Yesterday, and port 8084 conflicts with 2FA)
# - Disables batch-prod and postfix (production backend services, need DB_HOST_IP/MAIL_HOST_IP)
# - Disables playwright and apiv1-phpunit (not needed on Yesterday)
# - Exposes dev containers on external ports for yesterday access
#
# Note: We use deploy.replicas: 0 instead of overriding profiles because
# Docker Compose merges profile arrays (so profiles: [disabled] gets combined
# with the base profile, not replaced).

services:
  # Disable production-build containers (dev containers are sufficient for Yesterday)
  freegle-prod-local:
    deploy:
      replicas: 0

  modtools-prod-local:
    deploy:
      replicas: 0

  # Disable MCP support tools (not needed on Yesterday, mcp-query-sanitizer uses port 8084
  # which conflicts with yesterday-2fa)
  mcp-query-sanitizer:
    deploy:
      replicas: 0

  mcp-interface:
    deploy:
      replicas: 0

  mcp-pseudonymizer:
    deploy:
      replicas: 0

  # Disable production backend services (need DB_HOST_IP/MAIL_HOST_IP which aren't set on Yesterday)
  batch-prod:
    deploy:
      replicas: 0

  postfix:
    deploy:
      replicas: 0

  # Disable test containers (not needed on Yesterday)
  playwright:
    deploy:
      replicas: 0

  apiv1-phpunit:
    deploy:
      replicas: 0

  # Remap apiv2 port to avoid conflict with yesterday-traefik (which uses 8193)
  apiv2:
    ports: !reset
      - "8195:8192"

  # Expose dev containers on external ports for yesterday server
  freegle-dev-local:
    ports:
      - "3002:3002"

  modtools-dev-local:
    ports:
      - "3003:3000"

# Use the pre-existing external volume for the yesterday database
# (created before docker-compose added project name prefix)
volumes:
  freegle_db:
    external: true
